<script>
    const calendar = document.getElementById('calendar');
    const monthYear = document.getElementById('monthYear');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');
    const bookingForm = document.getElementById('bookingForm');
    const selectedDayInput = document.getElementById('selectedDay');

    let currentDate = new Date();
    let availabilities = {};

    async function fetchAvailabilities() {
        const response = await fetch('/api/availabilities');
        const data = await response.json();
        data.forEach(day => {
            availabilities[day[0]] = day[1];
        });
        renderCalendar(currentDate);
    }

    function renderCalendar(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();
        calendar.innerHTML = '';
        monthYear.textContent = date.toLocaleString('fr-FR', { month: 'long', year: 'numeric' });

        for (let i = 0; i < firstDay; i++) {
            const emptyDiv = document.createElement('div');
            emptyDiv.classList.add('day');
            calendar.appendChild(emptyDiv);
        }

        for (let day = 1; day <= lastDate; day++) {
            const dayStr = `${year}-${month + 1}-${day}`;
            const dayDiv = document.createElement('div');
            dayDiv.classList.add('day');
            dayDiv.textContent = day;

            if (availabilities[dayStr] === 1) {
                dayDiv.classList.add('available');
                dayDiv.addEventListener('click', function () {
                    const availableDays = document.querySelectorAll('.day.available');
                    availableDays.forEach(d => d.style.border = 'none');
                    this.style.border = '2px solid #155d38';
                    selectedDayInput.value = dayStr;
                });
            } else {
                dayDiv.classList.add('booked');
            }

            calendar.appendChild(dayDiv);
        }
    }

    prevMonthBtn.addEventListener('click', function () {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
    });

    nextMonthBtn.addEventListener('click', function () {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
    });

    bookingForm.addEventListener('submit', function (event) {
        if (!selectedDayInput.value) {
            event.preventDefault();
            alert('Veuillez s√©lectionner un jour disponible.');
        }
    });

    // Fetch availabilities and render the calendar on initial load
    fetchAvailabilities();
</script>